# Инструкция по сборке и запуску проекта

## Предварительные требования

- Установлен Docker и Docker Compose
- Клонирован репозиторий этого проекта

## Шаги запуска

1. Клонируйте репозиторий:
```bash
git clone https://github.com/niccneimi/link-cutter
cd link-cutter
```

2. Создайте файл `.env` в корне репозитория и заполните необходимыми переменными окружения
```
DB_HOST=db
DB_PORT=5432
POSTGRES_DB=mydatabase
POSTGRES_USER=myuser
POSTGRES_PASSWORD=securepassword
SHORT_LINK_ID_LENGTH=10
APP_DOMAIN_NAME=lc.ru.tuna.am
```
3. Запустите приложение и базу данных с помощью Docker Compose:
```bash
docker compose up -d --build
```

4. Проверьте, что контейнеры работают:
```bash
docker compose ps
```

5. При необходимости остановите контейнеры:
```bash
docker compose down
```
## Пример использования

#### Создание короткой ссылки
```bash
curl -X POST -H "Content-Type: application/json" -d '{"link":"https://www.youtube.com/watch?v=dQw4w9WgXcQ"}' https://lc.ru.tuna.am/api/link

```
#### Переход по сокращенной ссылке

https://lc.ru.tuna.am/s8omr8pozg

## Особенности

- Конфигурация Spring Boot подхватывает переменные из `.env`.

- Данные PostgreSQL сохраняются в volume `db_data`, поэтому данные будут сохранены между перезапусками, что даёт сохранение состояния сервиса.

- Сервис принимает длинную ссылку через поле `link`, возвращает короткую ссылку в поле `shortLink`. `shortLink` = https://domain/`shortLinkId`

- Если `link` уже ранее сокращалась, то возвращается ранее сгенерированная `shortLink`

- Перед запуском можно конфигурировать длинну сокращаемой ссылки через переменную окружения SHORT_LINK_ID_LENGTH в `.env`

- Если `link` ранее сокращалась, но SHORT_LINK_ID_LENGTH не совпадает с длинной `shortLinkId`, то `shortLink` будет сгенерирован заново с нужной длинной указанной в SHORT_LINK_ID_LENGTH

## Масштабирование
Сервис можно масштабировать используя оркестраторы контейнров запуская несколько реплик приложения. 

Как альтернатива можно использовать флаг `--scale` при запуске контейнеров

(перед этим из docker-compose.yml следует удалить services.app.ports)
```bash
docker compose up -d --scale app=3
```
Далее через указание портов запущенных реплик в реверс прокси (например nginx) реализовать распределение с внешнего порта на реплики

## В проекте реализовано
- Работающий веб-сервер с REST API и HTTP endpoint для обработки запросов
- Возможность перехода по короткой ссылке с редиректом на оригинальный адрес
- Упаковку приложения в Docker и возможность запуска через docker-compose
- Логирование
- Конфигурируемая длина сокращаемых ссылок через SHORT_LINK_ID_LENGTH
- Сохранение состояния сервиса (возможность пережить рестарт) благодаря использованию PostgreSQL и volume
- Приложение развёрнуто на реальном хостинге и доступно по https://lc.ru.tuna.am/
- Для доступа к приложению используется технология тунелирования